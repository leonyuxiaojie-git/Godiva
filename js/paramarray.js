var _pa_=["absolute","bottom","right","mouseup","hidden","pointerout","mousedown","pointerover","mousemove","mouseout","function","hotspot","action","container","mouseover","px solid ","</div>","translateZ(+2000000000000px)"," - xml parsing failed!","MSPointerOut","text/xml","#000000","default","false","error"," - loading failed! (","deg) translateZ(","MSPointerOver","image.tablet","image.mobile","preserve-3d","parsererror","contextmenu","undefined","].content","#FFFFFF","pointer","moveto","string","height","iphone","plugin","align","image","width","-webkit-text-size-adjust"," - wrong encryption!","deg) rotateY(","easeoutquad","<container>","Courier New","translate(","sans-serif","cubestrip","position","onresize","pagehide","boolean","lefttop","visible","webkit","normal","Origin","border","krpano","color","blend","webgl","mouse"," - loading or parsing failed!"," - loading not possible!","webkitvisibilitychange","] skipped flash file: ","mozvisibilitychange","msvisibilitychange","experimental-webgl","orientationchange","unknown action: ","actions overflow","visibilitychange","MSGestureChange","showlicenseinfo","MSInertiaStart","DOMMouseScroll","MSGestureStart","pointerEvents","MSGestureEnd","onmousewheel","px) rotateX(","loading of ","onmousedown","translateY(","scene.count","fullscreen","krpano.com","mousewheel","background","font-size:","box-shadow","webkit-3d","marginTop","moz-webgl","onmouseup","touchmove","fontSize"," failed!","-10000px","touchend","relative","keydown","krpano ","onclick","Chrome ","onkeyup","object","scene[","event:","scroll","parent","center","resize","LOOKTO","rotate","mobile","iPhone","hlookat vlookat camroll fov maxpixelzoom fisheye fisheyefovlink architectural","<table style='width:100%;height:100%;'><tr style='valign:middle;'><td>"," - invalid name! Names need to begin with an alphabetic character!","ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=","A Browser with CSS 3D Transforms or WebGL support is required!","abs acos asin atan ceil cos exp floor log round sin sqrt tan","if(%5!=NEXTLOOP,%1);if(%2,%4;%3;for(%1,%2,%3,%4,NEXTLOOP););","drawing to canvas failed - probably no available memory...","Y(90deg) Y(0deg) Y(-90deg) Y(180deg) X(-90deg) X(90deg)","if(%1,%2;delayedcall(0,asyncloop(%1,%2,%3));,%3);","there is already a html element with this id: ","<div style='padding:8px; text-align:center;'>","","' not found - using 'easeOutQuad' instead!"," - invalid or unsupported xml encryption!","there is no html element with this id: ","<div style='margin:-1px 0px -1px 0px;'>","<div style='margin:-5px 2px -5px 2px;'>","No iPhone/iPad/HTML5 images available!","<div style='margin:2px 2px 2px 2px;'>","No HTML5 compatible images available!","javascript:document.getElementById('","About the krpano Panorama Viewer...","left front right back up down cube","1px solid rgba(255,255,255,0.5)","Javascript Interface disabled!","xx=lz=rg=ma=dm=ed=eu=ek=rd=pt=","translateZ(+1000000000000px) ","kr;user;mail=;domain;file:;id"," - loading not possible![br]","-webkit-tap-highlight-color","<div style='margin:0px;'>","<div style='padding-top:"," (not a cubestrip image)","krpano embedding error: ","set(_busyonloaded,false)","ignoring preview image ","architecturalonlymiddle","if(%1,%2;loop(%1,%2););","webkitRequestFullScreen","webkitRequestFullscreen","(-webkit-transform-3d)","399841005/09/12/2011","mozRequestFullScreen","423121455/31/08/2012","397888275/20/11/2011","389475345/26/08/2011","330634415/10/05/2010","391980335/22/09/2011","418416935/30/06/2012","401725815/28/12/2011","420391265/26/07/2012","361082345/05/01/2011","405497075/04/02/2012","409922307/20/03/2012","331706505/19/05/2010","translateZ(+1000px) ","336250455/23/06/2010","410819005/29/03/2012","addlayer/addplugin(","msRequestFullscreen","px; padding-bottom:","px,0px) translateY(","px;overflow:hidden;","rgba(255,255,255,0)","0px 0px 8px #FFFFFF","translate3D(0,0,0)","-ms-overflow-style","position:absolute;","preview.striporder","-webkit-box-shadow","</td></tr></table>","Internet Explorer","WebkitPerspective","http://krpano.com","<krpano></krpano>","onenterfullscreen","onpreviewcomplete","] loading error: ","requestFullscreen","background-color:","FullscreenChange","rgba(0,0,0,0.01)","__defineSetter__","onexitfullscreen","__defineGetter__","fullscreenchange","webkitUserSelect","LICENSE EXPIRED","px) translateX(","textshadowrange","-moz-box-shadow","deg) translate(","consolelog=true","px)perspective("," <small>(build ","MSPointerCancel","Android Browser","backgroundcolor","backgroundalpha","registered to: ","Exit Fullscreen","text/javascript","backgroundColor","textshadowalpha","textshadowcolor","krpanoSWFObject","textshadowangle","WebkitBoxShadow","1px solid white",")</small><br/>","border-radius:","backgroundSize","pointer-events","onloadcomplete","windows phone","textfield.swf","scalechildren"," not allowed!"," FATAL ERROR:","paddingBottom","LICENSE ERROR","onviewchanged","stereographic","deg) scale3D(","onxmlcomplete","gesturechange","pointercancel"," translate3D(","mozUserSelect","return false;","#FFF 0px 0px ","MSPointerMove","MSPointerDown","text-shadow:","tween type '","MozBoxShadow","gesturestart",") translate(","px) rotateZ(","translate3D(","keephotspots","&nbsp;</div>","paddingRight","perspective(","actioncaller","</encrypted>","maskchildren","image.level[","onremovepano","height:100%;","removescenes","onviewchange","preview.type","BlackBerry ","shadowalpha","touchcancel","keepplugins","MSPointerUp","shadowcolor","paddingLeft","shadowangle","pointermove","pointerdown","shadowrange","oninterrupt","px) rotate(","versioninfo","perspective","transparent","bordercolor","stageheight","translateZ(","borderalpha","ARM/Tablet ","preview.url","addhotspot(","borderwidth","<encrypted>","blackberry","textshadow","stagescale","autoheight","yesontrue1","keepscenes","fontFamily","whiteSpace","ignorekeep","showerrors","stagewidth","%FIRSTXML%","px) scale(","touchstart","paddingTop","2013-10-28","Fullscreen","px #FFFFFF","gestureend",") rotateZ(","FATALERROR","onovercrop"," Simulator","rim tablet","CURRENTXML","handcursor","ondowncrop","1px solid ","encrypted","onnewpano","asyncloop","onkeydown","roundedge","127.0.0.1","localhost"," (Chrome)","</center>","keepimage","</krpano>","fullrange","nopreview","].onstart","').call('","transform","bgcapture","__swfpath","distorted","textAlign","timertick","useragent","boxShadow","pointerup","overflow","-webkit-","rotateX(","limitfov","KENCGUBR","textblur"," style='","scale3d(","iemobile","0px 0px "," (build ","offrange","keepview","<krpano>","panotour","keepbase","rotateZ(","__fte2__","__fte1__","<center>","Firefox ","jsborder"," - WebGL","Calling ","UuXxCcHh","distance","jsplugin","FIRSTXML","asyncfor","Desktop/","HTMLPATH","pre-line","autosize","cylinder","vcenter","BASEDIR","enabled","zoomify","bglayer","krpano.","WARNING","license","Version"," debug)","fovtype","pannini"," Tablet","border:","bgcolor","bgalpha","display","50% 50%","include"," Mobile","Android","devices","webkit/","Trident","keepall","android"," - iOS:","Firefox","opacity","action[","Mobile ","SWFPATH","_blank","switch","Chrome","opaque","blend(","Webkit","Gecko/","Opera ","VvYyRr","flying","1.16.9","&nbsp;","&apos;","&quot;","logkey","shadow","random","stagex","onidle","CriOS/","origin","cursor","style[","Safari","stagey"," Build","zorder","lookat","width:","always","alturl","tablet","Tablet","drag2d","smooth","Mobile","linear","canvas","sphere","number","delete","www."];
var customhs=[
	{"pan":88,"titl":8,"width":"20px","height":"20px","bg":"pink","func":"getProductInfo"},
	{"pan":35,"titl":15,"width":"20px","height":"20px","bg":"pink"},
	{"pan":-90,"titl":90,"width":"20px","height":"20px","bg":"pink"}
]

function decode64(input) {
	 var output = "";
	 var chr1, chr2, chr3 = "";
	 var enc1, enc2, enc3, enc4 = "";
	 var i = 0;

	 // remove all characters that are not A-Z, a-z, 0-9, +, /, or =
	 var base64test = /[^A-Za-z0-9\+\/\=]/g;
	 if (base64test.exec(input)) {
		alert("There were invalid base64 characters in the input text.\n" +
			  "Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\n" +
			  "Expect errors in decoding.");
	 }
	 input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");

	 do {
		enc1 = keyStr.indexOf(input.charAt(i++));
		enc2 = keyStr.indexOf(input.charAt(i++));
		enc3 = keyStr.indexOf(input.charAt(i++));
		enc4 = keyStr.indexOf(input.charAt(i++));

		chr1 = (enc1 << 2) | (enc2 >> 4);
		chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
		chr3 = ((enc3 & 3) << 6) | enc4;

		output = output + String.fromCharCode(chr1);

		if (enc3 != 64) {
		   output = output + String.fromCharCode(chr2);
		}
		if (enc4 != 64) {
		   output = output + String.fromCharCode(chr3);
		}

		chr1 = chr2 = chr3 = "";
		enc1 = enc2 = enc3 = enc4 = "";

	 } while (i < input.length);

	 return unescape(output);
  }
  var keyStr = "ABCDEFGHIJKLMNOP" +
       "QRSTUVWXYZabcdef" +
       "ghijklmnopqrstuv" +
       "wxyz0123456789+/" +
       "=";
function gerExif(image_result){
	var data = image_result.replace("data:image/jpeg;base64,", "");
	var decoded_data = decode64(data);
	
	getLongAt = function(iOffset, bBigEndian) {
				var iByte1 = decoded_data.charCodeAt(iOffset),
					iByte2 = decoded_data.charCodeAt(iOffset + 1),
					iByte3 = decoded_data.charCodeAt(iOffset + 2),
					iByte4 = decoded_data.charCodeAt(iOffset + 3);

				var iLong = bBigEndian ? 
					(((((iByte1 << 8) + iByte2) << 8) + iByte3) << 8) + iByte4
					: (((((iByte4 << 8) + iByte3) << 8) + iByte2) << 8) + iByte1;
				if (iLong < 0) iLong += 4294967296;
				return iLong;
			};
	
	getSLongAt = function(iOffset, bBigEndian) {
		var iULong = getLongAt(iOffset, bBigEndian);
		if (iULong > 2147483647)
			return iULong - 4294967296;
		else
			return iULong;
	};
	
	var result = findEXIFinJPEG({ 
		getByteAt: function(idx) { return decoded_data.charCodeAt(idx); },
		getLength: function() { return decoded_data.length; },
		getShortAt: function(iOffset, bBigEndian) {
				var iShort = bBigEndian ? 
					(decoded_data.charCodeAt(iOffset) << 8) + decoded_data.charCodeAt(iOffset + 1)
					: (decoded_data.charCodeAt(iOffset + 1) << 8) + decoded_data.charCodeAt(iOffset)
				if (iShort < 0) iShort += 65536;
				return iShort;
			},
		getStringAt: function(a, b) { return decoded_data.substring(a, a+b); },
		getLongAt: getLongAt,
		getSLongAt: getSLongAt
	});
	return result;
}
function processrotate(r,base64,w,h,appos){
	var cv=document.createElement("canvas");
	var ctx=cv.getContext("2d");
	var temp=w;
	if(appos!="ios"){
		w=h;
		h=temp;
	}
	//alert(document.documentElement.clientWidth);
	//alert(document.documentElement.clientWidth*h/w)
	
	
	//alert(w+";"+h)
	cv.style.position="absolute";
	cv.style.top=0;
	cv.style.left=0;
	cv.style.zIndex=9999;
	if(r==6){
		cv.setAttribute("width",360);
		cv.setAttribute("height",360*(h/w));
		ctx.rotate(90*Math.PI/180,0,0);
		$("<img src=\""+base64+"\" />").load(function(){
			ctx.drawImage(this,0,0,h,w,0,-360,360*(h/w),360);
		});
		//$("body")[0].appendChild(cv);
	}else if(r==8){
		cv.setAttribute("width",360);
		cv.setAttribute("height",360*(h/w));
		ctx.rotate(-90*Math.PI/180,0,0);
		$("<img src=\""+base64+"\" />").load(function(){
			ctx.drawImage(this,0,0,h,w,0,360,360*(h/w),360);
		});
		//$("body")[0].appendChild(cv);
	}
	setTimeout(function(){processrotate.data=cv.toDataURL("image/png")},500);
}

function replaceimg(id,src,w,h){
	$("#selectphoto").attr("src","base64/"+src).data("width",w).data("height",h);
}
